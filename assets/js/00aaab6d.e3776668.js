(self.webpackChunkspecs=self.webpackChunkspecs||[]).push([[535],{1279:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return d},default:function(){return m}});var o=n(7462),r=n(3366),s=(n(7294),n(3905)),i=n(3456),a=["components"],l={title:"G\xe9olocalisation"},c=void 0,u={unversionedId:"Microservices/geolocation",id:"Microservices/geolocation",isDocsHomePage:!1,title:"G\xe9olocalisation",description:"Le syst\xe8me de geolocalisation permet de tracer et retrouver efficacement les personnes contacts en pr\xe9sence d'un cas confirm\xe9 positif. Afin d'optimiser le traitement des requ\xe8tes d'analyse nous avons opt\xe9 pour deux bases de donn\xe9es :",source:"@site/docs/Microservices/geolocation.md",sourceDirName:"Microservices",slug:"/Microservices/geolocation",permalink:"/specs/docs/Microservices/geolocation",editUrl:"https://github.com/covid-alert-microservices/specs/edit/master/docs/Microservices/geolocation.md",tags:[],version:"current",frontMatter:{title:"G\xe9olocalisation"},sidebar:"tutorialSidebar",previous:{title:"Alertes",permalink:"/specs/docs/Microservices/alerts"},next:{title:"News",permalink:"/specs/docs/Microservices/news"}},d=[{value:"Nouvelle localisation",id:"nouvelle-localisation",children:[],level:2},{value:"Mise \xe0 jour du graphe de proximit\xe9",id:"mise-\xe0-jour-du-graphe-de-proximit\xe9",children:[],level:2},{value:"Retrouver les personnes contacts",id:"retrouver-les-personnes-contacts",children:[],level:2}],p={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,a);return(0,s.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Le syst\xe8me de geolocalisation permet de tracer et retrouver efficacement les personnes contacts en pr\xe9sence d'un cas confirm\xe9 positif. Afin d'optimiser le traitement des requ\xe8tes d'analyse nous avons opt\xe9 pour deux bases de donn\xe9es :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Une base de donn\xe9e ",(0,s.kt)("a",{parentName:"li",href:"https://www.postgresql.org/"},"Postgres")," pour persister les localisations (anonymis\xe9es) des utilisateurs"),(0,s.kt)("li",{parentName:"ul"},"Une base de donn\xe9e graphe ",(0,s.kt)("a",{parentName:"li",href:"https://neo4j.com/"},"Neo4j")," qui maintiendra le graphe de proximit\xe9 des utilisateurs")),(0,s.kt)("p",null,"Les localisations, tout comme les liens de proximit\xe9, seront gard\xe9es pour un d\xe9lai maximum de 30 jours. La supression des donn\xe9es se fait \xe0 l'aide de CronTab."),(0,s.kt)("h2",{id:"nouvelle-localisation"},"Nouvelle localisation"),(0,s.kt)("p",null,"L'ajout d'une nouvelle localisation doit s'effectuer de mani\xe8re synchrone et ne prendre que quelques millisecondes. Une fois la localisation enregistr\xe9e, le controller \xe9met un \xe9venement sur Kafka pour finaliser le processus de mani\xe8re asynchrone."),(0,s.kt)(i.Mermaid,{chart:"%%{init: {\n    'theme': 'base', \n    'themeVariables': {\n        'actorTextColor': 'black',\n        'primaryTextColor': '#25c2a0'\n    }\n  }\n}%%\nsequenceDiagram\n    autonumber\n    activate Kafka\n    Agent ->> Controller: POST /geo\n    activate Controller\n    Controller ->> PostgresDB: insert geolocation\n    activate PostgresDB\n    PostgresDB ->> Controller: geolocation\n    deactivate PostgresDB\n    Controller ->> Kafka : geolocation_created\n    Controller ->> Agent: geolocation\n    deactivate Controller",mdxType:"Mermaid"}),(0,s.kt)("h2",{id:"mise-\xe0-jour-du-graphe-de-proximit\xe9"},"Mise \xe0 jour du graphe de proximit\xe9"),(0,s.kt)("p",null,"Quand une localisation est enregistr\xe9e il faut m\xeatre \xe0 jour le graphe de proximit\xe9 de mani\xe8re asynchrone. Cette mise \xe0 jour peut avoir lieu juste apr\xe8s l'enregistrement ou alors quelques secondes plus tard, cela n'a pas d'importance. Pour ce faire, il faut r\xe9cup\xe9rer toutes les localisations proches de celle qui vient d'\xeatre enregistr\xe9e dans un untervalle de temps de 5 minutes. Pour que deux localisations soient consid\xe9r\xe9es comme proche il faut qu'il y ait une variation maximale de 0.1 deg pour la longitude et la latitude. Apr\xe8s avoir affin\xe9 le nombre de localisations \xe0 prendre en compts, il faut s'assurer que les localisations sont r\xe9ellement proches en calculant la distance r\xe9elle qui les s\xe9pare. Seules les localisations tr\xe8s proches sont consid\xe9r\xe9es lors de la mise \xe0 jour du graphe de proximit\xe9."),(0,s.kt)(i.Mermaid,{chart:"%%{init: {\n    'theme': 'base', \n    'themeVariables': {\n        'actorTextColor': 'black',\n        'primaryTextColor': '#25c2a0'\n    }\n  }\n}%%\nsequenceDiagram\n    autonumber\n    activate Kafka\n    Kafka ->> Listener: geolocation_created\n    activate Listener\n    Listener ->> PostgresDB: get potential infected geolocations\n    activate PostgresDB\n    PostgresDB ->> Listener: geolocations\n    deactivate PostgresDB\n    Listener ->> Listener: compute geolocation distances\n    Listener ->> Listener: keep only close geolocations\n    Listener ->> Neo4j: create link between users\n    activate Neo4j\n    Neo4j ->> Listener: transaction status\n    deactivate Neo4j\n    deactivate Listener\n    ",mdxType:"Mermaid"}),(0,s.kt)("h2",{id:"retrouver-les-personnes-contacts"},"Retrouver les personnes contacts"),(0,s.kt)("p",null,"Lors d'un cas positif confirm\xe9 par un test, un listener est r\xe9veill\xe9 pour s'occuper de trouver les personnes contacts pour leur envoyer une alerte. La liste de ces personnes s'obtient gr\xe2ce \xe0 notre graphe de proximit\xe9 qui est tr\xe8s rapide et simple \xe0 parcourir (0-9ms). Il est possible de choisir le degr\xe9 de contact qu'il faut consid\xe9rer en r\xe9cup\xe9rant une partie du sous-graphe partant de l'individu contamin\xe9."),(0,s.kt)(i.Mermaid,{chart:"%%{init: {\n    'theme': 'base', \n    'themeVariables': {\n        'actorTextColor': 'black',\n        'primaryTextColor': '#25c2a0'\n    }\n  }\n}%%\nsequenceDiagram\n    autonumber\n    activate Kafka\n    Kafka ->> Listener: user_positive\n    activate Listener\n    Listener ->> Neo4j: get contact users\n    activate Neo4j\n    Neo4j ->> Listener: contact users\n    deactivate Neo4j\n    Listener ->> Kafka : send_alert\n    deactivate Listener\n    ",mdxType:"Mermaid"}))}m.isMDXComponent=!0},1748:function(e,t,n){var o={"./locale":9234,"./locale.js":9234};function r(e){var t=s(e);return n(t)}function s(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=s,e.exports=r,r.id=1748}}]);